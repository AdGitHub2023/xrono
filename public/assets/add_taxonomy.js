// ---------- Work Unit Creation
// When a developer needs to add work units
// to a project he/she has not been assigned
function update_calendar_block(){$.ajax({async:!0,url:"/dashboard/calendar",type:"GET",dataType:"script"})}function get_week(a){$.ajax({async:!0,url:"/dashboard/update_calendar?date="+a,type:"GET",dataType:"json",success:function(a){$(".calendar").html(a.data),$(".week_pagination").html(a.week_pagination),set_week_pagination_triggers()}})}function set_week_pagination_triggers(){$(".get_week_calendar").click(function(a){var b=/\d{4}-\d{2}-\d{2}/i.exec(this);return get_week(b),!1})}$("#checkbox").change(function(){var a=$("#work_unit_client_id");a.children().remove(),a.append(new Option("Select a client","")),$("#work_unit_project_id").children().remove(),$("#work_unit_project_id").append(new Option("Select a project","")),$("#work_unit_ticket_id").children().remove(),$("#work_unit_ticket_id").append(new Option("Select a ticket","")),this.checked?(this.value=1,$.get("/dashboard/collaborative_index",{id:this.value},function(b){$.each(b,function(b,c){a.append(new Option(c.name,c.id))}),a.trigger("liszt:updated")},"json")):$.get("/dashboard/json_index",{id:this.value},function(b){$.each(b,function(b,c){a.append(new Option(c.name,c.id))}),a.trigger("liszt:updated")},"json")}),$("#work_unit_client_id").change(function(){var a=$("#work_unit_project_id");a.children().remove(),a.append(new Option("Select a project","")),$("#work_unit_ticket_id").children().remove(),$("#work_unit_ticket_id").append(new Option("Select a ticket","")),this.value!=""&&(document.getElementById("checkbox").checked?$.get("/dashboard/collaborative_client",{id:this.value},function(b){$.each(b,function(b,c){a.append(new Option(c.name,c.id))}),a.trigger("liszt:updated")},"json"):$.get("/dashboard/client",{id:this.value},function(b){$.each(b,function(b,c){a.append(new Option(c.name,c.id))}),a.trigger("liszt:updated")},"json"))}),$("#work_unit_project_id").change(function(){var a=$("#work_unit_ticket_id");a.children().remove(),a.append(new Option("Select a ticket","")),a.append(new Option("New Ticket","-1"));if(!this.value.blank){var b=$("#checkbox");document.getElementById("checkbox").checked?$.get("/dashboard/collaborative_project",{id:this.value},function(b){$.each(b,function(b,c){a.append(new Option(c.name,c.id))}),a.trigger("liszt:updated")},"json"):$.get("/dashboard/project",{id:this.value},function(b){$.each(b,function(b,c){a.append(new Option(c.name,c.id))}),a.trigger("liszt:updated")},"json")}}),$("#work_unit_ticket_id").change(function(){this.value=="-1"?$("#on_demand_ticket").show():$("#on_demand_ticket").hide()}),$("#new_work_unit").submit(function(){var a=$(this);return $("#work_unit_submit").attr("disabled",!0),data={"work_unit[description]":a.find("#work_unit_description").val(),"work_unit[scheduled_at]":a.find("#work_unit_scheduled_at").val(),"work_unit[client_id]":a.find("#work_unit_client_id").val(),"work_unit[project_id]":a.find("#work_unit_project_id").val(),"work_unit[ticket_id]":a.find("#work_unit_ticket_id").val(),"work_unit[hours]":a.find("#work_unit_hours").val(),"work_unit[overtime]":a.find("#work_unit_overtime").val(),hours_type:a.find("#hours_type").val()},$("#on_demand_ticket").is(":visible")&&(data["ticket[name]"]=a.find("#on_demand_ticket_name").val(),data["ticket[description]"]=a.find("#on_demand_ticket_description").val(),data["ticket[estimated_hours]"]=a.find("#on_demand_ticket_estimated_hours").val()),$.ajax({async:!0,global:!1,url:a.attr("action"),type:"POST",dataType:"json",data:data,success:function(b){var c=b.notice;a.trigger("reset"),a.effect("highlight"),$("#on_demand_ticket").hide(),$("#work_unit_client_id").children().remove(),$("#work_unit_client_id").append(new Option("Select a client","")),$("#work_unit_project_id").children().remove(),$("#work_unit_project_id").append(new Option("Select a project","")),$("#work_unit_ticket_id").children().remove(),$("#work_unit_ticket_id").append(new Option("Select a ticket","")),document.getElementById("hours_type").options[0].selected=!0,$("#hours_type").selectedIndex=0,$("#hours_type").trigger("liszt:updated"),$.get("/dashboard/json_index",{id:this.value},function(a){$.each(a,function(a,b){$("#work_unit_client_id").append(new Option(b.name,b.id))}),$("#work_unit_client_id").trigger("liszt:updated"),$("#work_unit_project_id").trigger("liszt:updated"),$("#work_unit_ticket_id").trigger("liszt:updated")},"json"),update_calendar_block(),$("#scheduled_at").datepicker("setDate",new Date),$("#work_unit_scheduled_at").val(new Date),$("#schedule_modal_link").text($("#scheduled_at").val()),c&&($("#work_unit_errors").data("notice",c),$("#work_unit_errors").dialog("open")),$("#work_unit_submit").attr("disabled",!1)},error:function(a){var b=JSON.parse(a.responseText),c=b.errors;$("#work_unit_errors").data("errors",c),$("#work_unit_errors").dialog("open"),$("#work_unit_submit").attr("disabled",!1)}}),!1}),$("#work_unit_errors").dialog({autoOpen:!1,hide:!0,title:"Notice",modal:!0,draggable:!1,open:function(){var a=$("#work_unit_errors");a.html(""),a.data("errors")&&a.append("<p>"+a.data("errors")+"</p>"),a.data("notice")&&a.append("<p>"+a.data("notice")+"</p>")},close:function(){var a=$("#work_unit_errors");a.html("")}}),$("#ticket_client_id").change(function(){var a=$("#ticket_project_id");a.children().remove(),a.append(new Option("Select a project","")),$("#work_unit_ticket_id").children().remove(),$("#work_unit_ticket_id").append(new Option("Select a ticket","")),this.value!=""&&$.get("/dashboard/client",{id:this.value},function(b){$.each(b,function(b,c){a.append(new Option(c.name,c.id))}),a.trigger("liszt:updated")},"json")}),$("#ticket_project_id").change(function(){var a=$("#ticket_ticket_id");a.children().remove(),a.append(new Option("Select a ticket","")),this.value!=""&&$.get("/dashboard/project",{id:this.value},function(b){$.each(b,function(b,c){a.append(new Option(c.name,c.id))}),a.trigger("liszt:updated")},"json")}),$("#new_ticket").submit(function(){var a=$(this);return $("#ticket_submit").attr("disabled",!0),$.ajax({async:!0,global:!1,url:a.attr("action"),type:"POST",dataType:"json",data:{"ticket[project_id]":a.find("#ticket_project_id").val(),"ticket[name]":a.find("#ticket_name").val(),"ticket[estimated_hours]":a.find("#ticket_estimated_hours").val(),"ticket[description]":a.find("#ticket_description").val()},success:function(b){var c=$.parseJSON(b.responseText);a.trigger("reset"),a.effect("highlight"),$("#ticket_submit").attr("disabled",!1)},error:function(a){var b=$.parseJSON(a.responseText);$("#ticket_errors").data("errors",b),$("#ticket_errors").dialog("open"),$("#ticket_submit").attr("disabled",!1)}}),!1}),$("#ticket_errors").dialog({autoOpen:!1,hide:!0,title:"Error",modal:!0,draggable:!1,open:function(){var a=$("#ticket_errors");a.html(""),$.each(a.data("errors"),function(){a.append("<p>"+this+"</p>")})},close:function(){var a=$("#ticket_errors");a.html("")}}),set_week_pagination_triggers()